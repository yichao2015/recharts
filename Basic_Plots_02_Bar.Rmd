---
title: "Basic Plots 02 - Bar/Column"
output: 
  html_document: 
    number_sections: yes
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

First, you should load `recharts`:
```{r}
library(recharts)
```

# Introduction

Bar plot includes 6 basic types:

- horizontal bar (tiled): bar|hbar
- horizontal bar (stacked): bar_stack|hbar_stack|stacked_bar|stacked_hbar
- vertical bar (tiled): vbar|columns
- vertical bar (stacked): vbar_stack|column_stack|stacked_column|stacked_vbar
- histogram (freq): histogram|hist|histogram_count|hist_count|histogram_freq|hist_freq
- histogram (density): histogram_density|hist_density

<table id='intro'>
<tr><td>
```{r,echo=FALSE}
titanic <- data.table::melt(apply(Titanic, c(1,4), sum))
names(titanic) <- c('Class', 'Survived', 'Count')
echartr(titanic, Class, Count, Survived) %>% setLegend(pos=3) %>%
    setTheme('infographic', width=400, height=300) %>%
    setTitle('Titanic: Survival by Cabin Class','hbar')
```
</td>
<td>
```{r,echo=FALSE}
echartr(titanic, Class, Count, Survived, type='hbar_stack') %>% 
    setTheme('roma', width=400, height=300) %>% setLegend(pos=3) %>%
    setTitle('Titanic: Outcome by Cabin Class','hbar_stack')
```
</td></tr>
<tr><td>
```{r,echo=FALSE}
echartr(titanic, Class, Count, Survived, type='vbar') %>% 
    setLegend(pos=3) %>%
    setTheme('macarons', width=400, height=300) %>%
    setTitle('Titanic: Outcome by Cabin Class','vbar')
```
</td><td>
```{r,echo=FALSE}
echartr(titanic, Class, Count, Survived, type='vbar_stack') %>% 
    setLegend(pos=3) %>%
    setTheme('macarons2', width=400, height=300) %>%
    setTitle('Titanic: Outcome by Cabin Class','vbar_stack')
```
</td></tr>
<tr><td>
```{r,echo=FALSE}
echartr(iris, Sepal.Width) %>% setLegend(pos=3) %>%
    setTheme('blue', width=400, height=300) %>%
    setTitle('Iris Sepal Width','histogram')
```
</td><td>
```{r,echo=FALSE}
echartr(iris, Sepal.Width) %>% setLegend(pos=3) %>%
    setTheme('mint', width=400, height=300) %>%
    setTitle('Iris Sepal Width','histogram_density') %>%
    setYAxis(name='Density')
```
</td></tr>
</table>

The keys are:

- character `x` and numeric `y`
- each combination level of `x` (and `series`) can only have one `y` data point
- Tiled and stacked bar/column charts can shift from one to another by clicking type shift buttons in the toolbox widget.

# Function Call

```r
echartr(data, x, <y>, <series>, <z>, <type>)
```

+--------+--------------------------------------------------------------------+
| Arg    |  Requirement                                                       |
+========+====================================================================+
| **data** | source data in the form of data.frame                            |
+--------+--------------------------------------------------------------------+
| **x**  | - character independent variable. Other type will be coerced to factors. Only the first one is accepted if multiple variables are provided. |
|        | - numeric variable and `y` is omitted, in which case comes up with a histogram. |
+--------+--------------------------------------------------------------------+
| y      | - numeric dependent variable. Only the first one is accepted if multiple variables are provided. |
|        | - If y is omitted, and x is numeric, a histogram will be displayed. |
+--------+--------------------------------------------------------------------+
| series | data series variable which will be coerced to factors. Only the first one is accepted if multiple variables are provided. |
+--------+--------------------------------------------------------------------+
|  z     | timeline variable which will be coerced to factors. Only the first one is accepted if multiple variables are provided. |
+--------+--------------------------------------------------------------------+
| type   | - `x` is character and `y` is numeric, or 'x' is numeric and 'y' is omitted, you can omit 'type' or assign it 'auto'. |
|        | - You can also assign it 'bar', 'hbar', 'bar_stack', 'hbar_stack', 'stacked_bar', 'stacked_hbar', 'vbar', 'column', 'vbar_stack', 'column_stack', 'stacked_column', 'stacked_vbar', 'histogram', 'hist', 'histogram_count', 'hist_count', 'histogram_freq', 'hist_freq', 'histogram_density', 'hist_density'. |
+--------+--------------------------------------------------------------------+


# Showcase

## Data Preparation

Let's look into `Titanic` dataset embeded in the package `datasets`. The survival count by cabin class is shown as below:

```{r}
titanic <- data.table::melt(apply(Titanic, c(1,4), sum))
names(titanic) <- c('Class', 'Survived', 'Count')
knitr::kable(titanic)
```

## Horizontal Bar Chart

### Singular Series

`type` could be 'hbar', 'bar' or 'auto'.

```{r}
echartr(titanic[titanic$Survived=='Yes',], Class, Count) %>%
    setTitle('Titanic: N Survival by Cabin Class')
```

### Multiple Series

```{r}
echartr(titanic, Class, Count, Survived) %>%
    setTitle('Titanic: Survival Outcome by Cabin Class')
```

### Tornado Chart

Tornado chart is a special case. The keys are:

- An all-positive series and an all-negative series
- Tiled rather than stacked

```{r}
titanic_tc <- titanic
titanic_tc$Count[titanic_tc$Survived=='No'] <- 
    - titanic_tc$Count[titanic_tc$Survived=='No']
g <- echartr(titanic_tc, Class, Count, Survived, type='hbar') %>%
    setTitle("Titanic: Survival Outcome by Cabin Class")
g
```

Of course we need to adjust the axis a little bit as well.

```{r}
g %>% setYAxis(axisLine=list(onZero=TRUE))
```

### Population Pyramid

So when you apply 'hbar_stack', you yield a 'population pyramid' as usually used in sociology.

```{r}
echartr(titanic_tc, Class, Count, Survived, type='hbar_stack') %>%
    setTitle("Titanic: Survival Outcome by Cabin Class") %>%
    setYAxis(axisLine=list(onZero=TRUE))
```

### Bar Chart with Timeline

We need another variable as timeline. Let's say, 'sex'.

```{r}
titanic_sex <- data.table::melt(apply(Titanic, c(1,2,4), sum))
names(titanic_sex)[4] <- "Count"
knitr::kable(titanic_sex)
```

```{r}
echartr(titanic_sex, Class, Count, Survived, z=Sex, type='bar') %>% 
    setTitle("Titanic: Survival Outcome by Cabin Class Across Sex")
```

## Stacked Horizontal Bar Chart

Compared to hbar, you just set `type` 'bar_stack', 'hbar_stack', 'stacked_bar', or 'stacked_hbar'.

Grammar for singular and multiple series are similar to legacy hbar chart.

```{r}
echartr(titanic, Class, Count, Survived, type='hbar_stack') %>%
    setTitle('Titanic: Survival Outcome by Cabin Class') 
```

## Vertical Bar (Column) Chart

Compared to hbar, you just set `type` 'vbar', or 'column'.

Grammar for singular and multiple series are similar to legacy hbar chart.

```{r}
echartr(titanic, Class, Count, Survived, type='column') %>%
    setTitle('Titanic: Survival Outcome by Cabin Class') 
```

## Stacked Vertical Bar (Column) Chart

Compared to vbar, you just set `type` 'vbar_stack', 'column_stack', 'stacked_column', or 'stacked_vbar'.

Grammar for singular and multiple series are similar to legacy hbar chart.

```{r}
echartr(titanic, Class, Count, Survived, type='column_stack') %>%
    setTitle('Titanic: Survival Outcome by Cabin Class') 
```

## Histogram Chart (Stat by Freq)

Histogram is a special form of bar chart, in which you only provide numeric `x` variable.

`type` could be 'histogram', 'hist', 'histogram_count', 'hist_count', 'histogram_freq', or 'hist_freq'.

```{r}
echartr(iris, Sepal.Width) %>%
    setTitle('Iris: Histogram of Sepal.Width') 
```

## Histogram Chart (Stat by Density)

Sometimes you want a density historam, then set `type` 'histogram_desity' or 'hist_density'.

```{r}
echartr(iris, Sepal.Width, type='hist_density') %>%
    setTitle('Iris: Histogram of Sepal.Width') %>% setYAxis(name="Density")
```

# Futher Setup

Then you can configure the widgets, add markLines and/or markPoints, fortify the chart.

You can refer to related functions to play around on your own.

